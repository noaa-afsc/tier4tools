% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/spr_sensitivity.R
\name{plot_recprop_sensitivity}
\alias{plot_recprop_sensitivity}
\title{Plot multispecies sensitivity to recruitment proportions}
\usage{
plot_recprop_sensitivity(
  sens_uncon,
  sens_con,
  targets = c(0.4, 0.35),
  prop_col = "prop_value",
  show_delta = FALSE,
  include_species = FALSE,
  include_yield_share = FALSE,
  title = "Sensitivity of multispecies reference points to recruitment proportions",
  xlab = NULL
)
}
\arguments{
\item{sens_uncon}{A data frame returned by \code{spr_sensitivity()} with
\code{multispecies_constraint = "none"}.}

\item{sens_con}{A data frame returned by \code{spr_sensitivity()} with
\code{multispecies_constraint = "all_species"}.}

\item{targets}{Numeric vector of SPR targets to plot (values in (0, 1)),
for example \code{c(0.40, 0.35)}.}

\item{prop_col}{Character. Name of the recruitment proportion column to use on the x-axis.
Defaults to \code{"prop_value"} (recommended), but can be set to \code{"prop"} if desired.}

\item{show_delta}{Logical. If FALSE (default), plots absolute reference point F.
If TRUE, plots deviations from the unconstrained reference point (\eqn{\Delta F}).}

\item{include_species}{Logical. If TRUE, attempts to return a limiting-species plot as a second panel.}

\item{include_yield_share}{Logical. If TRUE, attempts to return an implied yield-share plot as a third panel.}

\item{title}{Character. Main plot title.}

\item{xlab}{Character. Optional x-axis label. If \code{NULL}, the function uses the species names
stored in \code{attr(sens_uncon, "species")} when available.}
}
\value{
If \code{include_species = FALSE} and \code{include_yield_share = FALSE},
returns a single ggplot object (the main plot).

Otherwise returns a named list with:
\describe{
\item{\code{main}}{The main reference-point sensitivity plot (ggplot).}
\item{\code{limiting_species}}{A limiting-species panel (ggplot) or \code{NULL}.}
\item{\code{yield_share}}{An implied yield-share panel (ggplot) or \code{NULL}.}
}
}
\description{
Creates report-ready plots summarizing how multispecies (complex-level) SPR reference points
change across recruitment proportion assumptions for two-species complexes. The function is
designed to work directly with the output of \code{spr_sensitivity()} run under two settings:
(1) an unconstrained run where complex reference points are derived from the combined SPR curve
(\code{multispecies_constraint = "none"}), and (2) a constrained run where all species must meet
the target SPR (\code{multispecies_constraint = "all_species"}).
}
\details{
\strong{Default behavior.} The main plot is a single panel where:
\itemize{
\item color = SPR target (for example, 0.40 vs 0.35), and
\item linetype = the reference point method (unconstrained vs constrained).
}

\strong{Delta option.} When \code{show_delta = TRUE}, the unconstrained values are plotted as a 0 baseline and the constrained values
shows the constraint-induced change at each recruitment proportion and target:
\deqn{\Delta F = F_{\mathrm{method}} - F_{\mathrm{unconstrained}}.}

\strong{Optional diagnostics.}
\itemize{
\item When \code{include_species = TRUE}, the function also attempts to return a limiting-species
panel based on species-specific reference point columns produced by \code{spr_sensitivity()}
(for example \code{F40_RE}, \code{F40_BS}). The limiting species is defined as the species with
the smallest species-specific reference point at each recruitment proportion and target.
\item When \code{include_yield_share = TRUE}, the function attempts to return an implied yield-share
panel using yield-share columns added by \code{spr_sensitivity()}, for example
\code{share40_RE}, \code{share40_BS}, and constrained equivalents
\code{share40_RE_constrained}, \code{share40_BS_constrained}. Yield shares are interpreted as
recruitment-weighted YPR contributions at the reference point F.
}
If the required columns are not present, the corresponding optional plots are returned as \code{NULL}.
}
\examples{
\dontrun{
sens_uncon <- spr_sensitivity(inp, prop = seq(0.2, 0.8, 0.05),
                             multispecies_constraint = "none")
sens_con   <- spr_sensitivity(inp, prop = seq(0.2, 0.8, 0.05),
                             multispecies_constraint = "all_species")

# Main plot only
plot_recprop_sensitivity(sens_uncon, sens_con)

# Delta plot
plot_recprop_sensitivity(sens_uncon, sens_con, show_delta = TRUE)

# Return diagnostic panels (if columns are available)
plots <- plot_recprop_sensitivity(
  sens_uncon, sens_con,
  include_species = TRUE,
  include_yield_share = TRUE
)
plots$main
plots$limiting_species
plots$yield_share
}

}
