% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/run_spr.R
\name{run_spr}
\alias{run_spr}
\title{Run per-recruit SPR and YPR calculations}
\usage{
run_spr(
  x,
  F_vec = seq(0, 0.4, by = 0.001),
  spr_targets = c(0.4, 0.35),
  multispecies_constraint = c("none", "all_species"),
  diagnostics = TRUE
)
}
\arguments{
\item{x}{An object returned by \code{spr_input()} defining ages and species-specific life history schedules.}

\item{F_vec}{Numeric vector of fishing mortality values (F) to evaluate. Must be finite and >= 0.}

\item{spr_targets}{Numeric vector of SPR targets in (0,1), for example \code{c(0.40, 0.35)}.}

\item{multispecies_constraint}{Character string specifying whether to apply a multispecies constraint
when selecting combined reference points. Options are:
\describe{
\item{\code{"none"}}{Unconstrained reference points are based on the combined SPR curve only.}
\item{\code{"all_species"}}{Constrained combined reference points, all species must meet the target SPR.}
}}

\item{diagnostics}{Logical. If TRUE, returns plus-group diagnostics and age-specific decompositions.}
}
\value{
A named list with the following elements:
\describe{
\item{\code{F_vec}}{Fishing mortality grid used for calculations.}
\item{\code{spr_targets}}{SPR targets requested.}
\item{\code{multispecies_constraint}}{Constraint setting used.}
\item{\code{SPR_total}}{Combined SPR(F) across species (length = \code{length(F_vec)}).}
\item{\code{YPR_total}}{Combined YPR(F) across species (length = \code{length(F_vec)}).}
\item{\code{SPR_by_species}}{Named list of species-specific SPR(F) vectors.}
\item{\code{YPR_by_species}}{Named list of species-specific YPR(F) vectors.}
\item{\code{F_spr_total}}{Named numeric vector of combined reference points (nearest-grid match),
for example \code{F40_total} and \code{F35_total}.}
\item{\code{F_spr_total_constrained}}{Named numeric vector of constrained combined reference points
when \code{multispecies_constraint="all_species"}; otherwise \code{NULL}.}
\item{\code{F_spr_by_species}}{Named list of species-specific reference points for each SPR target.}
\item{\code{diagnostics}}{A list with elements:
\itemize{
\item \code{Ftarget}: the fishing mortality value used for diagnostics (defaults to the first target,
and uses constrained \code{Ftarget} when available),
\item \code{plus_share}: plus-group share table (or \code{NULL} if \code{diagnostics=FALSE}),
\item \code{decomp}: age-specific decomposition data frame (or \code{NULL} if \code{diagnostics=FALSE}).
}}
}
}
\description{
Computes spawning potential ratio (SPR) and yield per recruit (YPR) across a
range of fishing mortality values for a single stock or multispecies complex
defined by \code{spr_input()}. The function returns species-specific and
combined (total) SPR(F) and YPR(F) curves, SPR-based fishing mortality
reference points (e.g., F40, F35), and optional decomposition diagnostics.
}
\details{
\strong{SPR and YPR.} For each species, unfished spawning biomass per recruit
(SBPR0) and fished SBPR(F) are computed from survivorship-at-age,
weight-at-age, and maturity-at-age. SPR is defined as \code{SPR(F) = SBPR(F)
/ SBPR(0)}. YPR is computed using the Baranov catch equation in biomass units
and the age-specific fishery selectivity.

\strong{Multispecies complexes.} For multispecies inputs, each species is
evaluated separately using its own life history schedules and recruitment
scaling (i.e., recruitment proportions in \code{spr_input()}). Combined SBPR
and yield are computed by summing across species.

\strong{SPR reference points.} Fishing mortality reference points are reported for:
\itemize{
\item the combined complex (\code{F_spr_total}), based on matching the combined SPR curve to
each value in \code{spr_targets} using a nearest-grid approach, and
\item each species individually (\code{F_spr_by_species}).
}

\strong{Multispecies constraint.} When \code{multispecies_constraint =
"all_species"}, a constrained reference point
(\code{F_spr_total_constrained}) is calculated for each SPR target as the max
F in \code{F_vec} such that \emph{both} the combined SPR and each
species-specific SPR meet or exceed the target. If no value satisfies the
constraint, \code{NA} is returned for that target.

\strong{Diagnostics and decomposition outputs.} When \code{diagnostics = TRUE}, the output includes:
\itemize{
\item \code{diagnostics$plus_share}: the fraction of total SBPR contributed by the terminal age
(often a plus group) at F = 0 and at the diagnostic reference F \code{Ftarget}, and
\item \code{diagnostics$decomp}: an age-specific df containing survivorship, maturity,
selectivity, weight-at-age, M-at-age, SBPR contributions, and SBPR removed
(F0 minus Ftarget) for each species at F = 0 and F = Ftarget.
}
These diagnostics can be visualized with \code{plot_spr_decomp()}.
}
\examples{
\dontrun{
# Assume inp is a spr_input() object (single species or multispecies).
# Run per-recruit calculations and request decomposition diagnostics.
spr_out <- run_spr(inp, diagnostics = TRUE,
                  multispecies_constraint = "all_species")

# reference points
spr_out$F_spr_total
spr_out$F_spr_total_constrained
spr_out$F_spr_by_species

# Plot SPR(F) curves, complex-level SPR and species-specific SPRs
# plot_spr_curves(spr_out, which = "total")
# plot_spr_curves(spr_out, which = "species")

# Decomposition diagnostics
plots <- plot_spr_decomp(spr_out, drop_plus_from_plot = TRUE)
plots$contrib
plots$removed
plots$survivorship

# Plus-group diagnostic table (fraction of SBPR in terminal age)
spr_out$diagnostics$plus_share
}

}
