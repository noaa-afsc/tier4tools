% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/spr_sensitivity.R
\name{spr_sensitivity}
\alias{spr_sensitivity}
\title{Sensitivity analysis for SPR reference points}
\usage{
spr_sensitivity(
  x_base,
  M = NULL,
  maturity_a50 = NULL,
  selex_ac = NULL,
  prop = NULL,
  F_vec = seq(0, 0.4, by = 0.002),
  spr_targets = c(0.4, 0.35),
  multispecies_constraint = c("none", "all_species"),
  use_constrained_for_yield = TRUE,
  digits = 3
)
}
\arguments{
\item{x_base}{A \code{spr_input()} object used as the base scenario.}

\item{M}{Numeric vector of scalar M values to apply. If \code{NULL}, M is not
varied.}

\item{maturity_a50}{Numeric vector of logistic maturity a50 values. If
\code{NULL}, not varied.}

\item{selex_ac}{Numeric vector of knife-edge selectivity a_c values. If
\code{NULL}, not varied.}

\item{prop}{Numeric vector of recruitment proportions for 2-species inputs.
Interpreted as the proportion assigned to the first species in
\code{names(x_base$species)}. Ignored for 1 species.}

\item{F_vec}{Fishing mortality grid passed to \code{run_spr()}.}

\item{spr_targets}{SPR targets passed to \code{run_spr()} (default
\code{c(0.40, 0.35)}).}

\item{multispecies_constraint}{Passed to \code{run_spr()} (\code{"none"} or
\code{"all_species"}).}

\item{use_constrained_for_yield}{Logical. If TRUE and constrained F40 exists,
evaluate \code{YPR_total} at constrained F40; otherwise evaluate at
unconstrained F40.}

\item{digits}{Digits used for formatting \code{scenario_label}.}
}
\value{
A df with one row per scenario. Columns include:
\describe{
\item{\code{scenario_id}}{Unique integer id.}
\item{\code{M}, \code{maturity_a50}, \code{selex_ac}, \code{prop}}{Scenario inputs (NA means base).}
\item{\code{F40_total}, \code{F35_total}}{Combined reference points (unconstrained).}
\item{\code{F40_total_constrained}, \code{F35_total_constrained}}{Combined constrained reference points
when \code{multispecies_constraint="all_species"} (otherwise NA).}
\item{\code{YPR_at_F40}}{Total yield per recruit evaluated at F40 (constrained if requested).}
\item{\code{plus_share_<sp>_F0}}{Plus-group share at F=0 for each species \code{<sp>}.}
\item{\code{plus_share_<sp>_Ftarget}}{Plus-group share at the diagnostic Ftarget for each species.}
\item{\code{scenario_label}}{Readable label concatenating scenario inputs.}
}
}
\description{
Runs a grid-based sensitivity analysis for Tier 4 SPR calculations by varying
a user-defined set of influential inputs. Available options include: scalar
natural mortality (M), logistic maturity \eqn{a_{50}}, knife-edge selectivity
\eqn{a_c}, and (for 2-species complexes) recruitment proportions.
}
\details{
This function modifies a base \code{spr_input()} object
\code{x_base} by updating one or more schedules and re-running
\code{run_spr()} for each scenario. The result is returned as a tidy data
frame suitable for sensitivity plots or tables.

\strong{Important limitation:} All sensitivity sweep dimensions are applied
to \emph{all species simultaneously}. For example, sweeping
\code{maturity_a50} sets the maturity ogive midpoint to the same value for
every species in the input, and sweeping \code{selex_ac} sets the same
knife-edge \eqn{a_c} for every species. Species-specific sensitivity sweeps
(varying a parameter for one species while holding others fixed) are not
currently implemented.

\strong{What can be varied:}
\itemize{
\item \code{M}: scalar \eqn{M} applied at all ages (replaces existing \code{M_at_age}).
\item \code{maturity_a50}: maturity ogive midpoint \eqn{a_{50}} for a logistic maturity schedule.
\item \code{selex_ac}: knife-edge selectivity age \eqn{a_c}.
\item \code{prop}: recruitment proportion assigned to the first species (2-species inputs only).
}

\strong{Outputs:} The returned df includes combined (total) and (optionally)
constrained SPR reference points (e.g., F40, F35), total YPR evaluated at
F40, and plus group diagnostics as separate columns for each species.
}
\examples{
\dontrun{
out <- spr_sensitivity(
  x_base,
  M = seq(0.03, 0.06, by = 0.005),
  maturity_a50 = seq(10, 20, by = 2),
  selex_ac = c(8, 10, 12),
  prop = seq(0.3, 0.7, by = 0.1),
  F_vec = seq(0, 0.4, by = 0.002),
  multispecies_constraint = "all_species"
)

# Heatmap: F40_total across (M, a50)
plot_sensitivity_heatmap(out, x = "M", y = "maturity_a50", fill = "F40_total")
}

}
